{% extends 'cards/app.html' %}

{% block sharemeta %}
  <title>Sunlo - Social Language Learning</title>
  <meta name="description" content="For language-learners who are self-teaching or learning from friends, immersed or trying to connect better with a mother tongue">

  <meta property="og:url" content="{{request.get_full_path}}" />
  <meta property="og:type" content="application" />
  <meta property="og:title" content="Sunlo - Social Language Learning" />
  <meta property="og:description" content="For language-learners who are self-teaching or learning from friends, immersed or trying to connect better with a mother tongue" />
  <meta property="og:image" content="" />
{% endblock %}

{% block back %}
{% if card.language in person.languages %}

<a href="{% url 'my_deck' card.language.name %}">
  <i class="fa fa-arrow-circle-left"></i> back to {{ card.language }} deck
</a>

{% endif %}
{% endblock %}

{% block content %}
<section class="card container">
  <div class="row">
    <div class="col-md-12">
      <h4 class="">{{ card.language.name }}{% if membership %}, {{ membership.status }}{% endif %}</h4>
      <h1>{{ card.text }}</h1>

    </div>
  </div>
  <div class="row">
    <div class="col-md-12 text-md-right m-t-1">
      <a id="add-translation-button" href="#" data-toggle="modal" data-target="#translation-add-form" aria-haspopup="true" aria-expanded="false">
        <i class="fa fa-plus-circle"></i> translation
      </a>
      <div class="blockquote m-y-1">
        {% for phrase in card.cardtranslation_set.all %}
        <h3 class="text-muted"><em>&ldquo;{{ phrase.text }}&rdquo;</em></h3>
        {% endfor %}
      </div>
    </div>

    {% if card.see_also.count %}
    <div class="col-md-6">
      <h4>Related</h4>
      <div class="">
        {% for phrase in card.see_also.all %}
        <h3><a href="{% url 'card_detail' phrase.id %}">{{ phrase.text }}</a></h3>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
  {% if deck %}
  <form method="post" role="form" action="{% url 'membership_update' card.id %}">
    {% csrf_token %}
    <div class="row m-y-2">
      <div class="col-md-4 m-b-1">
        {% if membership.status == 'learned' %}
        <button type="submit" name="status" value="learned" class="p-y-2 btn btn-block btn-success btn-lg">
          <i class="fa fa-star fa-lg"></i> Learned
        </button>
        {% elif membership.status == 'learning' %}
        <button type="submit" name="status" value="learned" class="p-y-2 btn btn-block btn-outline-success btn-lg">
          <i class="fa fa-star-o fa-lg"></i> Learned this!
        </button>
        {% else %}
        <button type="submit" name="status" value="learned" class="p-y-2 btn btn-block btn-outline-success btn-lg">
          <i class="fa fa-star-o fa-lg"></i> I know this!
        </button>
        {% endif %}
      </div>

      <div class="col-md-4 m-b-1">
        {% if membership.status == 'learning' %}
        <button type="submit" name="status" value="learning" class="p-y-2 btn btn-block btn-primary btn-lg">
          <i class="fa fa-star-half-o fa-lg"></i> Learning
        </button>
        {% elif membership.status == 'learned' %}
        <button type="submit" name="status" value="learning" class="p-y-2 btn btn-block btn-outline-primary btn-lg">
          <i class="fa fa-star-half-o fa-lg"></i> Still learning
        </button>
        {% else %}
        <button type="submit" name="status" value="learning" class="p-y-2 btn btn-block btn-outline-primary btn-lg">
          <i class="fa fa-download fa-lg"></i> Add to deck
        </button>
        {% endif %}
      </div>

      <div class="col-md-4 m-b-1">
        {% ifequal membership.status 'rejected' %}
        <button type="submit" name="status" value="rejected" class="p-y-2 btn btn-block btn-danger btn-lg">
          <i class="fa fa-times-circle fa-lg"></i> Rejected
        </button>
        {% else %}
        <button type="submit" name="status" value="rejected" class="p-y-2 btn btn-block btn-outline-danger btn-lg">
          <i class="fa fa-times-circle fa-lg"></i> Discard
        </button>
        {% endifequal %}
      </div>
    </div>
  </form>
  {% else %}
  <a href="{% url 'deck_add' %}" class="btn btn-primary btn-block btn-lg m-y-2 p-a-2">
    Start learning {{ card.language }}
  </a>
  {% endif %}

</section>

<div id="translation-add-form" class="modal fade">
  <div class="modal-dialog section" role="document">
    <div class="modal-content">
      <div class="modal-body">

        <form method="POST" action="{% url 'translation_add' card.id %}" role="form">
          {% csrf_token %}
          <label>Translation language</label>
          <select class="form-control m-b-1" name="language_name">
            <option value="">-- select language --</option>
            {% for language in person.speaks_languages.all %}
            <option value="{{ language.name }}">{{ language.name }}</option>
            {% endfor %}
          </select>
          <div class="form-group">
            <label>Translation text</label>
            <textarea name="text" class="form-control"></textarea>
            <a href="#" onclick="$('.form-group.literal').removeClass('hidden-xs-up'); $(this).remove()">
              Add a literal translation as well
            </a>
          </div>

          <div class="form-group hidden-xs-up literal">
            <label>Literal translation</label>
            <textarea name="literal" class="form-control"></textarea>
          </div>
          <div class="form-group">
            <input type="submit" class="btn btn-block btn-primary m-b-1"
            name="submit" value="Save translation">
          </div>

        </form>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% endblock %}
